{"ast":null,"code":"var _jsxFileName = \"/home/deepanshu/Documents/trio-calls/client/src/pages/auth/SignIn.tsx\",\n    _s = $RefreshSig$();\n\nimport * as React from \"react\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { useAppDispatch, useAppSelector } from \"core/hooks/redux\";\nimport { updateAuth } from \"core/reducers/auth\";\nimport { signIn } from \"@arpitbhalla/trio-calls/utils/auth.fetch\";\nimport { useSnackbar } from \"notistack\";\nimport Container from \"@material-ui/core/Container\";\nimport Box from \"@material-ui/core/Box\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Collapse from \"@material-ui/core/Collapse\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport EmailIcon from \"@material-ui/icons/EmailOutlined\";\nimport PasswordIcon from \"@material-ui/icons/LockOpen\";\nimport Button from \"@material-ui/core/Button\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Logo from \"@arpitbhalla/trio-calls/components/Logo\";\nimport ShadowBox from \"@arpitbhalla/trio-calls/components/ShadowBox\";\nimport { emailRegex } from \"./SignUp\";\nimport { useLocalStorage } from \"core/hooks/common\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst INITIAL_STATE = {\n  text: \"\",\n  error: \"\"\n};\n\nconst SignIn = () => {\n  _s();\n\n  const history = useHistory();\n  const dispatch = useAppDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    search\n  } = useLocation();\n  const {\n    isAuth\n  } = useAppSelector(_ref => {\n    let {\n      authReducer\n    } = _ref;\n    return authReducer;\n  });\n  const redirect_url = new URLSearchParams(search).get(\"redirect_url\") || \"/\";\n  const [email, setEmail] = React.useState(INITIAL_STATE);\n  const [password, setPassword] = React.useState(INITIAL_STATE);\n  const [loading, setLoading] = React.useState(false);\n  const [firstStepOver, setEmailExist] = React.useState(false);\n  const setUID = useLocalStorage(\"UID\", \"\")[1];\n\n  const handleLogin = async () => {\n    if (!emailRegex.test(email.text)) {\n      return setEmail({ ...email,\n        error: \"Field is invalid\"\n      });\n    } else if (!firstStepOver) {\n      return setEmailExist(true);\n    } else if (!password.text) {\n      return setPassword({ ...password,\n        error: \"Field is invalid\"\n      });\n    }\n\n    setLoading(true);\n    await signIn(email.text, password.text).then(userDetails => {\n      dispatch(updateAuth({\n        isAuth: true,\n        ...userDetails\n      }));\n      enqueueSnackbar(\"Welcome \" + userDetails.displayName);\n      setUID(JSON.stringify(userDetails));\n    }).catch(error => {\n      setLoading(false);\n      enqueueSnackbar(error || \"SomeThing went wrong\", {\n        variant: \"error\"\n      });\n    });\n  };\n\n  const redirectToSignUp = () => {\n    history.push(\"/auth/signUp?redirect_url=\" + redirect_url);\n  };\n\n  React.useEffect(() => {\n    if (isAuth) {\n      history.push(redirect_url);\n    }\n  }, [isAuth, redirect_url, history]);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"xs\",\n    children: /*#__PURE__*/_jsxDEV(ShadowBox, {\n      p: 4,\n      py: 5,\n      mt: 10,\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        align: \"center\",\n        children: /*#__PURE__*/_jsxDEV(Box, {\n          p: 1,\n          children: /*#__PURE__*/_jsxDEV(Logo, {\n            size: 8\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 78,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h5\",\n        align: \"center\",\n        color: \"primary\",\n        children: \"Sign in\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        align: \"center\",\n        color: \"primary\",\n        children: \"Use your Trio Calls account\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        py: 2,\n        children: [/*#__PURE__*/_jsxDEV(Collapse, {\n          in: !firstStepOver,\n          timeout: 200,\n          children: /*#__PURE__*/_jsxDEV(FormControl, {\n            error: !!email.error,\n            fullWidth: true,\n            children: [/*#__PURE__*/_jsxDEV(TextField, {\n              fullWidth: true,\n              error: !!email.error,\n              margin: \"normal\",\n              placeholder: \"Email\",\n              variant: \"outlined\",\n              value: email.text,\n              onChange: e => {\n                setEmail({\n                  error: \"\",\n                  text: e.target.value\n                });\n              },\n              onKeyDown: e => {\n                if (e.key === \"Enter\") setEmailExist(true);\n              },\n              autoFocus: true,\n              type: \"email\",\n              InputProps: {\n                startAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n                  position: \"start\",\n                  children: /*#__PURE__*/_jsxDEV(EmailIcon, {\n                    color: !email.error ? \"action\" : \"error\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 108,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 107,\n                  columnNumber: 21\n                }, this)\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 90,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(FormHelperText, {\n              children: email.error\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 113,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Collapse, {\n          in: firstStepOver,\n          timeout: 200,\n          children: /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(FormControl, {\n              error: !!password.error,\n              fullWidth: true,\n              children: [/*#__PURE__*/_jsxDEV(TextField, {\n                margin: \"normal\",\n                placeholder: \"Password\",\n                variant: \"outlined\",\n                type: \"password\",\n                error: Boolean(password.error),\n                onChange: e => {\n                  setPassword({\n                    error: \"\",\n                    text: e.target.value\n                  });\n                },\n                value: password.text,\n                onKeyDown: e => {\n                  if (e.key === \"Enter\") handleLogin();\n                },\n                autoFocus: true,\n                InputProps: {\n                  startAdornment: /*#__PURE__*/_jsxDEV(InputAdornment, {\n                    position: \"start\",\n                    children: /*#__PURE__*/_jsxDEV(PasswordIcon, {\n                      color: !password.error ? \"primary\" : \"error\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 137,\n                      columnNumber: 25\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 136,\n                    columnNumber: 23\n                  }, this)\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 120,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(FormHelperText, {\n                children: password.error\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 144,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 119,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              children: /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"text\",\n                color: \"primary\",\n                size: \"small\",\n                disabled: loading,\n                style: {\n                  textTransform: \"capitalize\"\n                },\n                onClick: () => setEmailExist(false),\n                children: \"Go Back\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 147,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 146,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 117,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        fullWidth: true,\n        size: \"large\",\n        color: \"primary\",\n        variant: \"contained\",\n        disabled: loading,\n        onClick: handleLogin,\n        children: firstStepOver ? \"Login\" : \"Next\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"text\",\n        color: \"primary\",\n        fullWidth: true,\n        onClick: redirectToSignUp,\n        children: \"Create new account\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SignIn, \"1+nQXz4+cGKdPT3DqylJgi4vbbY=\", false, function () {\n  return [useHistory, useAppDispatch, useSnackbar, useLocation, useAppSelector, useLocalStorage];\n});\n\n_c = SignIn;\nexport default SignIn;\n\nvar _c;\n\n$RefreshReg$(_c, \"SignIn\");","map":{"version":3,"sources":["/home/deepanshu/Documents/trio-calls/client/src/pages/auth/SignIn.tsx"],"names":["React","useHistory","useLocation","useAppDispatch","useAppSelector","updateAuth","signIn","useSnackbar","Container","Box","FormControl","FormHelperText","TextField","Collapse","InputAdornment","EmailIcon","PasswordIcon","Button","Typography","Logo","ShadowBox","emailRegex","useLocalStorage","INITIAL_STATE","text","error","SignIn","history","dispatch","enqueueSnackbar","search","isAuth","authReducer","redirect_url","URLSearchParams","get","email","setEmail","useState","password","setPassword","loading","setLoading","firstStepOver","setEmailExist","setUID","handleLogin","test","then","userDetails","displayName","JSON","stringify","catch","variant","redirectToSignUp","push","useEffect","e","target","value","key","startAdornment","Boolean","textTransform"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport { useHistory, useLocation } from \"react-router-dom\";\nimport { useAppDispatch, useAppSelector } from \"core/hooks/redux\";\nimport { updateAuth } from \"core/reducers/auth\";\nimport { signIn } from \"@arpitbhalla/trio-calls/utils/auth.fetch\";\nimport { useSnackbar } from \"notistack\";\nimport Container from \"@material-ui/core/Container\";\nimport Box from \"@material-ui/core/Box\";\nimport FormControl from \"@material-ui/core/FormControl\";\nimport FormHelperText from \"@material-ui/core/FormHelperText\";\nimport TextField from \"@material-ui/core/TextField\";\nimport Collapse from \"@material-ui/core/Collapse\";\nimport InputAdornment from \"@material-ui/core/InputAdornment\";\nimport EmailIcon from \"@material-ui/icons/EmailOutlined\";\nimport PasswordIcon from \"@material-ui/icons/LockOpen\";\nimport Button from \"@material-ui/core/Button\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Logo from \"@arpitbhalla/trio-calls/components/Logo\";\nimport ShadowBox from \"@arpitbhalla/trio-calls/components/ShadowBox\";\nimport { emailRegex } from \"./SignUp\";\nimport { useLocalStorage } from \"core/hooks/common\";\n\nconst INITIAL_STATE = { text: \"\", error: \"\" };\n\nconst SignIn: React.FC = () => {\n  const history = useHistory();\n  const dispatch = useAppDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n  const { search } = useLocation();\n  const { isAuth } = useAppSelector(({ authReducer }) => authReducer);\n\n  const redirect_url = new URLSearchParams(search).get(\"redirect_url\") || \"/\";\n\n  const [email, setEmail] = React.useState(INITIAL_STATE);\n  const [password, setPassword] = React.useState(INITIAL_STATE);\n  const [loading, setLoading] = React.useState(false);\n  const [firstStepOver, setEmailExist] = React.useState(false);\n  const setUID = useLocalStorage(\"UID\", \"\")[1];\n\n  const handleLogin = async () => {\n    if (!emailRegex.test(email.text)) {\n      return setEmail({ ...email, error: \"Field is invalid\" });\n    } else if (!firstStepOver) {\n      return setEmailExist(true);\n    } else if (!password.text) {\n      return setPassword({ ...password, error: \"Field is invalid\" });\n    }\n\n    setLoading(true);\n\n    await signIn(email.text, password.text)\n      .then((userDetails) => {\n        dispatch(updateAuth({ isAuth: true, ...userDetails }));\n        enqueueSnackbar(\"Welcome \" + userDetails.displayName);\n        setUID(JSON.stringify(userDetails));\n      })\n      .catch((error) => {\n        setLoading(false);\n        enqueueSnackbar(error || \"SomeThing went wrong\", {\n          variant: \"error\",\n        });\n      });\n  };\n  const redirectToSignUp = () => {\n    history.push(\"/auth/signUp?redirect_url=\" + redirect_url);\n  };\n  React.useEffect(() => {\n    if (isAuth) {\n      history.push(redirect_url);\n    }\n  }, [isAuth, redirect_url, history]);\n\n  return (\n    <Container maxWidth=\"xs\">\n      <ShadowBox p={4} py={5} mt={10}>\n        <Typography align=\"center\">\n          <Box p={1}>\n            <Logo size={8} />\n          </Box>\n        </Typography>\n        <Typography variant=\"h5\" align=\"center\" color=\"primary\">\n          Sign in\n        </Typography>\n        <Typography variant=\"body1\" align=\"center\" color=\"primary\">\n          Use your Trio Calls account\n        </Typography>\n        <Box py={2}>\n          <Collapse in={!firstStepOver} timeout={200}>\n            <FormControl error={!!email.error} fullWidth>\n              <TextField\n                fullWidth\n                error={!!email.error}\n                margin=\"normal\"\n                placeholder=\"Email\"\n                variant=\"outlined\"\n                value={email.text}\n                onChange={(e) => {\n                  setEmail({ error: \"\", text: e.target.value });\n                }}\n                onKeyDown={(e) => {\n                  if (e.key === \"Enter\") setEmailExist(true);\n                }}\n                autoFocus\n                type=\"email\"\n                InputProps={{\n                  startAdornment: (\n                    <InputAdornment position=\"start\">\n                      <EmailIcon color={!email.error ? \"action\" : \"error\"} />\n                    </InputAdornment>\n                  ),\n                }}\n              />\n              <FormHelperText>{email.error}</FormHelperText>\n            </FormControl>\n          </Collapse>\n\n          <Collapse in={firstStepOver} timeout={200}>\n            <>\n              <FormControl error={!!password.error} fullWidth>\n                <TextField\n                  margin=\"normal\"\n                  placeholder=\"Password\"\n                  variant=\"outlined\"\n                  type=\"password\"\n                  error={Boolean(password.error)}\n                  onChange={(e) => {\n                    setPassword({ error: \"\", text: e.target.value });\n                  }}\n                  value={password.text}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\") handleLogin();\n                  }}\n                  autoFocus\n                  InputProps={{\n                    startAdornment: (\n                      <InputAdornment position=\"start\">\n                        <PasswordIcon\n                          color={!password.error ? \"primary\" : \"error\"}\n                        />\n                      </InputAdornment>\n                    ),\n                  }}\n                />\n                <FormHelperText>{password.error}</FormHelperText>\n              </FormControl>\n              <Box display=\"flex\" justifyContent=\"space-between\">\n                <Button\n                  variant=\"text\"\n                  color=\"primary\"\n                  size=\"small\"\n                  disabled={loading}\n                  style={{ textTransform: \"capitalize\" }}\n                  onClick={() => setEmailExist(false)}\n                >\n                  Go Back\n                </Button>\n              </Box>\n            </>\n          </Collapse>\n        </Box>\n        <Button\n          fullWidth\n          size=\"large\"\n          color=\"primary\"\n          variant=\"contained\"\n          disabled={loading}\n          onClick={handleLogin}\n        >\n          {firstStepOver ? \"Login\" : \"Next\"}\n        </Button>\n        <Button\n          variant=\"text\"\n          color=\"primary\"\n          fullWidth\n          onClick={redirectToSignUp}\n        >\n          Create new account\n        </Button>\n      </ShadowBox>\n    </Container>\n  );\n};\n\nexport default SignIn;\n"]},"metadata":{},"sourceType":"module"}